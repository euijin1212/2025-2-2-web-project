<%- include('partials/header') %>

<!-- ÏÉÅÎã® ÌÉÄÏù¥ÌãÄ -->
<div class="mb-2 p-2 rounded-2">
    <div class="d-flex align-items-end">
        <h2 class="mb-0 me-3 d-flex align-items-center">
            <img src="/images/user.png" alt="ÏÇ¨Ïö©Ïûê" class="icon-png">MYPAGE
        </h2>
    </div>
</div>

<!-- ÎÇ¥ ÌîÑÎ°úÌïÑ -->
<div class="mb-4 p-4 rounded-2 border bg-secondary-subtle">
    <% if (user) { %>
        <p class="mb-1"><img src="/images/user-b.png" alt="ÏÇ¨Ïö©Ïûê" class="icon-png-small"><strong><%= user.nickname %></strong></p>
        <p class="mb-1"><img src="/images/envelope (1).png" alt="Ïù¥Î©îÏùº" class="icon-png-small"> <%= user.email %></p>
    <% } else { %>
        <p class="text-muted">Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.</p>
    <% } %>

    <div class="mt-3 d-flex gap-2">
        <a href="/studies/new" class="btn btn-primary btn-sm">ÏÉà Ïä§ÌÑ∞Îîî ÎßåÎì§Í∏∞</a>
    </div>
</div>

<!-- ÎÇ¥Í∞Ä ÎßåÎì† Ïä§ÌÑ∞Îîî -->
<div class="mb-2 p-2 rounded-2">
    <div class="d-flex align-items-end">
        <h3 class="mb-0 me-3 d-flex align-items-center">
            <img src="/images/book-alt.png" alt="Ï±Ö" class="icon-png">ÎÇ¥Í∞Ä ÎßåÎì† Ïä§ÌÑ∞Îîî
        </h3>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
    <% if (typeof myStudies !== 'undefined' && myStudies && myStudies.length > 0) { %>
        <% myStudies.forEach(study => { %>
            <div class="col">
                <div class="card h-100 shadow-sm position-relative border border-secondary-subtle" style="overflow: hidden;">
                    
                    <!-- Ï†ÑÏ≤¥ ÌÅ¥Î¶≠ ÎßÅÌÅ¨ -->
                    <a href="/studies/<%= study.id %>" class="stretched-link">
                        <span class="visually-hidden">ÏÉÅÏÑ∏Î≥¥Í∏∞</span>
                    </a>

                    <div class="row g-0 h-100">
                        <!-- [Ï¢åÏ∏°] Ïù¥ÎØ∏ÏßÄ ÏòÅÏó≠ -->
                        <div class="col-4 position-relative" style="min-height: 180px;">
                            <% if (study.bookCoverUrl) { %>
                                <img src="<%= study.bookCoverUrl %>" 
                                     class="img-fluid h-100 w-100 position-absolute top-0 start-0" 
                                     style="object-fit: cover;" 
                                     alt="Ï±Ö ÌëúÏßÄ">
                            <% } else { %>
                                <div class="d-flex align-items-center justify-content-center h-100 bg-light text-muted small">
                                    No Image
                                </div>
                            <% } %>
                        </div>

                        <!-- [Ïö∞Ï∏°] Ï†ïÎ≥¥ ÏòÅÏó≠ -->
                        <div class="col-8 d-flex flex-column">
                            <div class="card-body p-3">
                                
                                <!-- ÏÉÅÎã®: Ï±Ö Ï†úÎ™© Î±ÉÏßÄ -->
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <% if (study.bookTitle) { %>
                                        <span class="badge bg-dark text-light border text-truncate d-inline-block" style="max-width: 70%;">
                                            <%= study.bookTitle %>
                                        </span>
                                    <% } else { %>
                                        <span></span>
                                    <% } %>

                                    <!-- üî• ÏÇ≠Ï†ú Î≤ÑÌäº Î≥µÍµ¨ (HEAD Í∏∞Îä• Ïú†ÏßÄ) -->
                                    <form action="/studies/<%= study.id %>/delete" method="POST"
                                          onsubmit="return confirm('Ïù¥ Ïä§ÌÑ∞ÎîîÎ•º Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?');"
                                          style="z-index: 2; position: relative;">
                                        <button type="submit" class="btn btn-sm btn-outline-danger py-0 px-2" style="font-size: 0.8rem;">
                                            ÏÇ≠Ï†ú
                                        </button>
                                    </form>
                                </div>

                                <h6 class="card-title fw-bold mb-1 text-truncate"><%= study.title %></h6>
                                
                                <p class="card-text text-muted small mb-0">
                                    <%= (study.description || '').length > 40 
                                        ? study.description.substring(0, 40) + '...' 
                                        : (study.description || '') %>
                                </p>
                                
                                <small class="text-muted d-block mt-2">
                                    ÏÉùÏÑ±Ïùº: <%= new Date(study.createdAt).toISOString().slice(0, 10) %>
                                </small>
                            </div> 
                            
                            <!-- ÏöîÏùº Ï†ïÎ≥¥ -->
                            <div class="d-flex gap-1 p-3 mt-auto pt-0">
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'mon' ? 'border-dark text-light bg-dark' : '' %>">Ïõî</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'tue' ? 'border-dark text-light bg-dark' : '' %>">Ìôî</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'wed' ? 'border-dark text-light bg-dark' : '' %>">Ïàò</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'thu' ? 'border-dark text-light bg-dark' : '' %>">Î™©</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'fri' ? 'border-dark text-light bg-dark' : '' %>">Í∏à</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'sat' ? 'border-dark text-light bg-dark' : '' %>">ÌÜ†</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'sun' ? 'border-dark text-light bg-dark' : '' %>">Ïùº</span>
                            </div>
                        </div> 
                    </div> <!-- //row -->
                </div> <!-- //card -->
            </div> <!-- //col -->
        <% }) %>
    <% } else { %>
        <div class="col-12">
            <div class="alert alert-light border text-center py-5">
                <p class="text-muted mb-0">ÎÇ¥Í∞Ä ÎßåÎì† Ïä§ÌÑ∞ÎîîÍ∞Ä ÏïÑÏßÅ ÏóÜÏäµÎãàÎã§.</p>
            </div>
        </div>
    <% } %>
</div>

<%- include('partials/footer') %>
