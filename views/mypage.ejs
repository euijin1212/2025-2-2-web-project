<%- include('partials/header') %>

<div class="container py-4">

  <!-- 내 프로필 -->
  <div class="mb-4 p-4 bg-light rounded-3">
    <h2 class="mb-3">내 프로필</h2>

    <% if (user) { %>
      <p class="mb-1"><strong>닉네임:</strong> <%= user.nickname %></p>
      <p class="mb-1"><strong>이메일:</strong> <%= user.email %></p>
    <% } else { %>
      <p class="text-muted">로그인이 필요합니다.</p>
    <% } %>

    <div class="mt-3 d-flex gap-2">
      <a href="/clubs/create" class="btn btn-primary btn-sm">새 스터디 만들기</a>
    </div>
  </div>

  <!-- 내가 만든 스터디 -->
  <div class="mb-4">
    <h3 class="mb-3">내가 만든 스터디</h3>

    <% if (myStudies && myStudies.length > 0) { %>
      <div class="list-group">
        <% myStudies.forEach(study => { %>
          <div class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <h5 class="mb-1">
                <a href="/studies/<%= study.id %>"><%= study.title %></a>
              </h5>

              <p class="mb-1 text-muted">
                <%= (study.description || '').length > 60 
                      ? study.description.substring(0, 60) + '...' 
                      : (study.description || '') %>
              </p>

              <small class="text-muted d-block">
                <% if (study.day) { %>
                  요일:
                  <% if (study.day === 'mon') { %>월<% } %>
                  <% if (study.day === 'tue') { %>화<% } %>
                  <% if (study.day === 'wed') { %>수<% } %>
                  <% if (study.day === 'thu') { %>목<% } %>
                  <% if (study.day === 'fri') { %>금<% } %>
                  <% if (study.day === 'sat') { %>토<% } %>
                  <% if (study.day === 'sun') { %>일<% } %>
                <% } else { %>
                  요일: 미정
                <% } %>
              </small>

              <small class="text-muted">
                생성일: <%= study.createdAt.toISOString().slice(0, 10) %>
              </small>
            </div>

            <!-- 🔥 삭제 버튼: /studies/:id/delete 로 POST -->
            <form action="/studies/<%= study.id %>/delete" method="POST"
                  onsubmit="return confirm('이 스터디를 정말 삭제하시겠습니까?');">
              <button type="submit" class="btn btn-sm btn-outline-danger">삭제</button>
            </form>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p class="text-muted">내가 만든 스터디가 아직 없습니다.</p>
    <% } %>
  </div>
</div>

<%- include('partials/footer') %>
