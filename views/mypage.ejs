<%- include('partials/header') %>

<div class="mb-2 p-2 rounded-2">
    <div class="d-flex align-items-end">
        <h2 class="mb-0 me-3 d-flex align-items-center">
            <img src="/images/user.png" alt="사용자" class="icon-png">MYPAGE
        </h2>
    </div>
</div>

<!-- 내 프로필 -->
<div class="mb-4 p-4 rounded-2 border bg-secondary-subtle">
    <% if (user) { %>
        <p class="mb-1"><img src="/images/user-b.png" alt="사용자" class="icon-png-small"><strong><%= user.nickname %></strong></p>
        <p class="mb-1"><img src="/images/envelope (1).png" alt="이메일" class="icon-png-small"> <%= user.email %></p>
    <% } else { %>
        <p class="text-muted">로그인이 필요합니다.</p>
    <% } %>
</div>

<!-- 내가 만든 스터디 -->
<div class="mb-2 p-2 rounded-2">
    <div class="d-flex align-items-end">
        <h3 class="mb-0 me-3 d-flex align-items-center">
            <img src="/images/book-alt.png" alt="사용자" class="icon-png">내가 만든 스터디
        </h3>
    </div>
</div>

<div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
    <% if (typeof myStudies !== 'undefined' && myStudies && myStudies.length > 0) { %>
        <% myStudies.forEach(study => { %>
            <div class="col">
                <div class="card h-100 shadow-sm position-relative border border-secondary-subtle" style="overflow: hidden;">
                    
                    <!-- 전체 클릭 링크 -->
                    <a href="/studies/<%= study.id %>" class="stretched-link">
                        <span class="visually-hidden">상세보기</span>
                    </a>

                    <div class="row g-0 h-100">
                        <!-- [좌측] 이미지 영역 -->
                        <div class="col-4 position-relative" style="min-height: 180px;">
                            <% if (study.bookCoverUrl) { %>
                                <img src="<%= study.bookCoverUrl %>" 
                                        class="img-fluid h-100 w-100 position-absolute top-0 start-0" 
                                        style="object-fit: cover;" 
                                        alt="책 표지">
                            <% } else { %>
                                <div class="d-flex align-items-center justify-content-center h-100 bg-light text-muted small">
                                    No Image
                                </div>
                            <% } %>
                        </div>

                        <!-- [우측] 정보 영역 -->
                        <div class="col-8 d-flex flex-column">
                            <div class="card-body p-3">
                                
                                <!-- 상단: 책 제목 뱃지 -->
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <% if (study.bookTitle) { %>
                                        <span class="badge bg-dark text-light border text-truncate d-inline-block" style="max-width: 70%;">
                                            <%= study.bookTitle %>
                                        </span>
                                    <% } else { %>
                                        <span></span>
                                    <% } %>
                                    
                                    <!-- 삭제 버튼 (z-index 필수)
                                    <form action="/studies/<%= study.id %>/delete" method="POST" 
                                            onsubmit="return confirm('이 스터디를 정말 삭제하시겠습니까?');"
                                            style="z-index: 2; position: relative;">
                                        <button type="submit" class="btn btn-sm btn-outline-danger py-0 px-2" style="font-size: 0.8rem;">
                                            삭제
                                        </button>
                                    </form> -->
                                </div>

                                <h6 class="card-title fw-bold mb-1 text-truncate"><%= study.title %></h6>
                                
                                <p class="card-text text-muted small mb-0">
                                    <%= (study.description || '').length > 40 
                                        ? study.description.substring(0, 40) + '...' 
                                        : (study.description || '') %>
                                </p>
                                
                                <small class="text-muted d-block mt-2">
                                    생성일: <%= new Date(study.createdAt).toISOString().slice(0, 10) %>
                                </small>
                            </div> 
                            
                            <!-- 요일 정보 -->
                            <div class="d-flex gap-1 p-3 mt-auto pt-0">
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'mon' ? 'border-dark text-light bg-dark' : '' %>">월</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'tue' ? 'border-dark text-light bg-dark' : '' %>">화</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'wed' ? 'border-dark text-light bg-dark' : '' %>">수</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'thu' ? 'border-dark text-light bg-dark' : '' %>">목</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'fri' ? 'border-dark text-light bg-dark' : '' %>">금</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'sat' ? 'border-dark text-light bg-dark' : '' %>">토</span>
                                <span class="badge rounded-pill text-bg-light border border-secondary-subtle <%= study.day === 'sun' ? 'border-dark text-light bg-dark' : '' %>">일</span>
                            </div>
                        </div> 
                    </div> <!-- //row -->
                </div> <!-- //card -->
            </div> <!-- //col -->
        <% }) %>
    <% } else { %>
        <div class="col-12">
            <div class="alert alert-light border text-center py-5">
                <p class="text-muted mb-0">내가 만든 스터디가 아직 없습니다.</p>
            </div>
        </div>
    <% } %>
</div>


<%- include('partials/footer') %>