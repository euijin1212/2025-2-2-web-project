<%- include('partials/header') %>

<div class="container mt-4">
  <!-- 게시글 제목/정보 -->
  <h2 class="mb-3"><%= post.title %></h2>
  <p class="text-muted">
    작성자: <%= post.authorName || '알 수 없음' %><br>
    작성일: <%= new Date(post.createdAt).toLocaleString('ko-KR') %>
  </p>

  <div class="border rounded p-3 mb-4" style="white-space: pre-line;">
    <%= post.content %>
  </div>

  <div class="mb-3">
    <a href="/studies/<%= study.id %>/board" class="btn btn-outline-secondary btn-sm">
      ← 게시판 목록으로
    </a>
    <a href="/studies/<%= study.id %>/room" class="btn btn-outline-secondary btn-sm">
      스터디 홈으로
    </a>
  </div>

  <hr>

  <!-- 🔹 댓글 목록 -->
  <h5 class="mt-4">댓글</h5>

  <div class="mb-3">
    <% if (comments && comments.length > 0) { %>
      <% comments.forEach(function(c) { %>
        <div class="border rounded p-2 mb-2">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <strong><%= c.nickname || '알 수 없음' %></strong>
              <small class="text-muted">(<%= c.createdAtFormatted %>)</small>
            </div>
            <% if (currentUserId && c.userId === currentUserId) { %>
              <form action="/studies/<%= study.id %>/board/<%= post.id %>/comments/<%= c.id %>/delete"
                    method="POST"
                    style="display:inline;">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        onclick="return confirm('댓글을 삭제하시겠습니까?');">
                  삭제
                </button>
              </form>
            <% } %>
          </div>
          <div style="white-space: pre-line;" class="mt-1">
            <%= c.content %>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <div class="text-muted">아직 댓글이 없습니다. 첫 댓글을 남겨보세요!</div>
    <% } %>
  </div>

  <!-- 🔹 댓글 작성 폼 -->
  <h5 class="mt-4">댓글 작성</h5>
  <form action="/studies/<%= study.id %>/board/<%= post.id %>/comments" method="POST">
    <div class="mb-3">
      <textarea name="content"
                class="form-control"
                rows="3"
                placeholder="댓글을 입력하세요..."
                required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">댓글 등록</button>
  </form>
</div>

<%- include('partials/footer') %>
