<%- include('partials/header') %>

<style>
  .study-detail-container {
    max-width: 1100px;
    margin: 2rem auto;
  }

  .study-detail-header {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  }

  .book-cover-detail {
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

  .book-cover-detail img {
    width: 100%;
    height: auto;
    max-height: 500px;
    object-fit: contain;
  }

  .study-info-detail {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.4) 0%, rgba(118, 75, 162, 0.4) 100%);
    border: 2px solid rgba(102, 126, 234, 0.15);
    border-radius: 16px;
    padding: 2rem;
  }

  .study-info-detail h1 {
    color: #ffffff;
    font-weight: 800;
    font-size: 2rem;
    margin-bottom: 1.5rem;
  }

  .badge-detail {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-weight: 600;
  }

  .btn-action {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    display: inline-block;
  }

  .btn-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    color: white;
  }

  .btn-secondary-action {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(79, 172, 254, 0.3);
    display: inline-block;
  }

  .btn-secondary-action:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(79, 172, 254, 0.4);
    color: white;
  }

  .description-box {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    border-left: 4px solid #667eea;
    color: #2d3748;
    line-height: 1.8;
    white-space: pre-line;
    display: block;
    vertical-align: top;
  }

  .description-box::first-line {
    margin-top: 0;
  }
</style>

<div class="container study-detail-container">
  <div class="row mb-4">
    <div class="col-md-5">
      <div class="book-cover-detail">
        <% if (study.bookCoverUrl) { %>
          <img src="<%= study.bookCoverUrl %>" alt="ì±… í‘œì§€">
        <% } else { %>
          <div class="bg-light d-flex align-items-center justify-content-center"
               style="width:100%; height:500px;">
            <span class="text-muted" style="font-size: 1.2rem; font-weight: 500;">ì±… í‘œì§€ ì—†ìŒ</span>
          </div>
        <% } %>
      </div>
    </div>

    <div class="col-md-7">
      <div class="study-info-detail">
        <h1 style="color: #ffffff !important; -webkit-text-fill-color: #ffffff !important; background: none !important;"><%= study.title %></h1>

        <% if (study.bookTitle) { %>
          <p class="mb-2" style="font-size: 1.2rem;">
            <strong style="color: #ffffff;">ğŸ“š <%= study.bookTitle %></strong>
          </p>
        <% } %>
        <% if (study.bookAuthor) { %>
          <p class="mb-3" style="font-size: 1rem; color: #ffffff;">âœï¸ <%= study.bookAuthor %></p>
        <% } %>

        <div class="mb-3">
          <% if (study.day) { %>
            <span class="badge-detail me-2">
              ìš”ì¼:
              <% if (study.day === 'mon') { %>ì›”ìš”ì¼<% } %>
              <% if (study.day === 'tue') { %>í™”ìš”ì¼<% } %>
              <% if (study.day === 'wed') { %>ìˆ˜ìš”ì¼<% } %>
              <% if (study.day === 'thu') { %>ëª©ìš”ì¼<% } %>
              <% if (study.day === 'fri') { %>ê¸ˆìš”ì¼<% } %>
              <% if (study.day === 'sat') { %>í† ìš”ì¼<% } %>
              <% if (study.day === 'sun') { %>ì¼ìš”ì¼<% } %>
            </span>
          <% } %>

          <% if (study.maxMembers) { %>
            <span class="badge-detail" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
              ìµœëŒ€ <%= study.maxMembers %>ëª…
            </span>
          <% } %>
        </div>

        <p style="color: #ffffff; font-weight: 500; font-size: 1.05rem; margin-bottom: 1.5rem;">
          ê°œì„¤ì: <%= study.creatorName || 'ì•Œ ìˆ˜ ì—†ìŒ' %>
        </p>

        <hr style="border-color: rgba(102, 126, 234, 0.2); margin: 1.5rem 0;">

        <!-- ğŸ”¥ ìµœì¢… ë³‘í•©ëœ ë²„íŠ¼ ì˜ì—­: HEAD ê¸°ëŠ¥ + ìˆ˜ì • ë²„íŠ¼ -->
        <div class="mb-3">

          <% if (!user) { %>
            <!-- ë¹„ë¡œê·¸ì¸ -->
            <a href="/login" class="btn-action">
              <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px; vertical-align: -3px;">
                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
              </svg>
              ë¡œê·¸ì¸ í›„ ê°€ì… ê°€ëŠ¥í•©ë‹ˆë‹¤
            </a>

          <% } else if (!isMember) { %>
            <!-- ì•„ì§ ê°€ì… ì•ˆ í•œ ìœ ì € â†’ ê°€ì… ë²„íŠ¼ -->
            <form action="/studies/<%= study.id %>/join" method="POST" style="display: inline;">
              <button type="submit" class="btn-action" style="border: none;">
                ğŸ™‹ ìŠ¤í„°ë”” ê°€ì…í•˜ê¸°
              </button>
            </form>

          <% } else { %>
            <!-- ì´ë¯¸ ê°€ì…ëœ ìœ ì € -->
            <a href="/studies/<%= study.id %>/room" class="btn-action me-2">
              <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px; vertical-align: -3px;">
                <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5ZM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5 5 5Z"/>
              </svg>
              ìŠ¤í„°ë”” í™ˆìœ¼ë¡œ ì´ë™
            </a>

            <% if (!isOwner) { %>
              <!-- ë¦¬ë”ê°€ ì•„ë‹Œ ë©¤ë²„ë§Œ íƒˆí‡´ ê°€ëŠ¥ -->
              <form action="/studies/<%= study.id %>/leave" method="POST" style="display:inline;">
                <button type="submit" class="btn" style="background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 12px; font-weight: 600;">
                  âŒ íƒˆí‡´í•˜ê¸°
                </button>
              </form>
            <% } %>
          <% } %>

          <!-- ğŸ”§ ë¦¬ë”ë§Œ ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€ (feat/frontend ê¸°ëŠ¥ í†µí•©) -->
          <% if (user && study.creatorId && user.id === study.creatorId) { %>
            <a href="/studies/<%= study.id %>/edit" class="btn-secondary-action ms-2">
              <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px; vertical-align: -3px;">
                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
              </svg>
              ìˆ˜ì •í•˜ê¸°
            </a>
          <% } %>

        </div>

        <h5 style="color: #2d3748; font-weight: 700; margin-top: 2rem; margin-bottom: 1rem;">ğŸ“– ìŠ¤í„°ë”” ì†Œê°œ ë° ê·œì¹™</h5>
        <div class="description-box">
          <%= study.description %>
        </div>

        <a href="/studies" class="btn-secondary-action mt-3">
          <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 6px; vertical-align: -3px;">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
          </svg>
          ë‹¤ë¥¸ ìŠ¤í„°ë”” ë³´ëŸ¬ê°€ê¸°
        </a>
      </div>
    </div>
  </div>
</div>

<%- include('partials/footer') %>
